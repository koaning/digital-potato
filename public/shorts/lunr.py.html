

<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<title>Short Introduction to lunr.py</title>

<meta name="title" content="Short Introduction to lunr.py">
<meta name="description" content="In this short introduction we're doing to demonstrate how to use lunr.py.">

<meta property="og:type" content="website">
<meta property="og:url" content="https://calmcode.io/">
<meta property="og:title" content="Short Introduction to lunr.py">
<meta property="og:description" content="In this short introduction we're doing to demonstrate how to use lunr.py.">
<meta property="og:image" content="https://calmcode.io/images/lunr.png">

<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://calmcode.io/">
<meta property="twitter:title" content="Short Introduction to lunr.py">
<meta property="twitter:description" content="In this short introduction we're doing to demonstrate how to use lunr.py.">
<meta property="twitter:image" content="https://calmcode.io/images/lunr.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/python.min.js"></script>

    <meta charset="utf-8">
    <meta name="ahrefs-site-verification" content="f77ddfb426fd9bed439f4c38a319d416b1d0df2e33f0a1da56ff6d31c13b1c33">
    <link rel="icon" type="image/png" href="/images/logo.png"/>
    <link rel="shortcut icon" type="image/png" href="/images/logo.png"/>
    <link href="/style.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.8.0"></script>
    <script async defer data-domain="calmcode.io" src="https://plausible.io/js/plausible.js"></script>
</head>

<body>
    <nav class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
            <div class="relative flex justify-between h-16">
                <div class="flex-1 flex items-center sm:items-stretch sm:justify-start">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" "><img class="block h-8 w-auto" src="/images/logo.png" alt="Logo" /></a>
                        <div class="hidden sm:ml-12 sm:flex sm:space-x-8">
                            <a href="/search.html" class="border-transparent text-gray-700 hover:text-green-500 inline-flex items-center px-2 pt-1 border-b-2 text-md font-medium"> Explore </a>
                            <a href="/tracks.html" class="border-transparent text-gray-700 hover:text-green-500 inline-flex items-center px-2 pt-1 border-b-2 text-md font-medium"> Course Tracks </a>
                            <a href="/labs.html"   class="border-transparent text-gray-700 hover:text-green-500 inline-flex items-center px-2 pt-1 border-b-2 text-md font-medium"> Labs </a>
                            <a href="/tils.html"   class="border-transparent text-gray-700 hover:text-green-500 inline-flex items-center px-2 pt-1 border-b-2 text-md font-medium"> TIL </a>
                            <a href="/blog/"       class="border-transparent text-gray-700 hover:text-green-500 inline-flex items-center px-2 pt-1 border-b-2 text-md font-medium"> Blog </a>
                        </div>
                    </div>
                    <div class="flex-grow h-16">
                    </div>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0">
                        <!-- <p>Login</p> -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div>
        
<div class="">
    <br>
    <div class="rounded-xl border-gray-400">
        <div class="bg-white max-w-4xl mx-auto px-2 sm:px-6 lg:px-8 pt-4">
            <a href="/#shorts" class="text-left">Back to main.</a><br>
            <div class="text-center">
                <h3 class="uppercase text-lg leading-6 font-bold text-gray-500">
                    Calmcode Shorts
                </h3>
                <h1 class="text-2xl md:text-2xl font-bold py-2">
                    <img class="w-8 md:w-12 lg:w-18 inline-block" src="/images/lunr.svg" alt="lunr.py logo"><span class="pl-4">lunr.py</span>
                </h1>
            </div>
        </div>

        <div class="pb-6">
            <div class="bg-white max-w-4xl mx-auto px-2 sm:px-6 lg:px-8 pt-4">
                <div class="relative bg-white" style="padding-bottom: 56.25%;">
                    <div class="absolute inset-0" data-vimeo-initialized="true">
                        <div class="relative" style="padding-top: 56.25%;">
                            <iframe src="https://player.vimeo.com/video/721870979" frameborder="0" allow="autoplay; fullscreen" allowfullscreen="" class="absolute inset-0 w-full h-full"></iframe>
                        </div>
                    </div>
                </div>
                <article class="prose">
                    <div class="md:text-md">
                        <p>When you're using the search functionality on a <a href="https://squidfunk.github.io/mkdocs-material/">mkdocs material</a> site then you're using <a href="https://lunrjs.com/">lunr.js</a> in the background. It's a lightweight search engine that can handle smaller datasets pretty well. <a href="https://github.com/yeraydiazdiaz/lunr.py">Lunr.py</a> provides a backend solution, allowing you to parse the documents in Python ahead of time and create a Lunr.js index that you can use locally or pass to Lunr.js.</p>
<h2>Dataset</h2>
<p>Let's grab a <a href="/datasets/clinc.html">dataset</a> to give a demo of lunr.</p>
<pre><code class="lang-python">import pandas as pd

df = pd.read_csv(&quot;https://calmcode.io/datasets/clinc.csv&quot;).assign(idx=lambda d: d.index)
df.sample(3)
</code></pre>
<table>
<thead><tr>
<th style="text-align:left">text</th>
<th style="text-align:left">label</th>
<th style="text-align:right">idx</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">what is my intetest rate</td>
<td style="text-align:left">interest_rate</td>
<td style="text-align:right">16717</td>
</tr>
<tr>
<td style="text-align:left">go through all the reminders on my list and state what they are</td>
<td style="text-align:left">reminder</td>
<td style="text-align:right">9521</td>
</tr>
<tr>
<td style="text-align:left">what ingredients go in a milky way</td>
<td style="text-align:left">ingredients_list</td>
<td style="text-align:right">14794</td>
</tr>
</tbody>
</table>
<h2>Building an Index</h2>
<p>We'll use this <code>text</code> column as a string we'd like to query against. Lunr assumes
a list of dictionaries as a data structure, so we'll convert our dataframe first.</p>
<pre><code class="lang-python">documents = df.to_dict(orient=&quot;records&quot;)
</code></pre>
<p>Next, we can create an index.</p>
<pre><code class="lang-python">from lunr import lunr

index = lunr(ref=&#39;idx&#39;, fields=(&#39;text&#39;,), documents=documents)
</code></pre>
<p>The <code>lunr</code> function has three parameters.</p>
<ul>
<li><code>ref</code> is the key in the documents to be used sa the reference.</li>
<li><code>fields</code> is a sequence of keys to index from the documents.</li>
<li><code>documents</code> is the list of dictionaries that resemble the documents to be indexed.</li>
</ul>
<p>This gives us an <code>index</code> variable that we can use to query our data.</p>
<pre><code class="lang-python">index.search(&#39;spanish&#39;)
# [{&#39;ref&#39;: &#39;4501&#39;, &#39;score&#39;: 7.801, &#39;match_data&#39;: &lt;MatchData &quot;spanish&quot;&gt;},
#  {&#39;ref&#39;: &#39;3&#39;, &#39;score&#39;: 7.62, &#39;match_data&#39;: &lt;MatchData &quot;spanish&quot;&gt;},
#  {&#39;ref&#39;: &#39;26&#39;, &#39;score&#39;: 7.62, &#39;match_data&#39;: &lt;MatchData &quot;spanish&quot;&gt;},
#  ...
#  {&#39;ref&#39;: &#39;19726&#39;, &#39;score&#39;: 5.065, &#39;match_data&#39;: &lt;MatchData &quot;spanish&quot;&gt;}]
</code></pre>
<p>This index gives us a score as well as a reference to our original data. We
can re-use this to get our original documents again.</p>
<pre><code class="lang-python">[documents[int(i[&#39;ref&#39;])] for i in index.search(&#39;spanish&#39;)]
# [{&#39;text&#39;: &quot;can you tell me how to say &#39;i do not speak much spanish&#39;, in spanish&quot;,
#  &#39;label&#39;: &#39;translate&#39;,
#  &#39;idx&#39;: 4501},
# {&#39;text&#39;: &#39;how do you say fast in spanish&#39;, &#39;label&#39;: &#39;translate&#39;, &#39;idx&#39;: 3},
# {&#39;text&#39;: &#39;what is dog in spanish&#39;, &#39;label&#39;: &#39;translate&#39;, &#39;idx&#39;: 26},
# ...
# {&#39;text&#39;: &#39;please change your language setting to spanish now&#39;,
#  &#39;label&#39;: &#39;change_language&#39;,
#  &#39;idx&#39;: 19726}]
</code></pre>
<h2>Saving and Loading</h2>
<p>Once computed, you can also store the search index on disk to reload later.</p>
<pre><code class="lang-python">import json
from lunr.index import Index

serialized = idx.serialize()

# Save the index
with open(&#39;idx.json&#39;, &#39;w&#39;) as fd:
    json.dump(serialized, fd)

# Load it again
with open(&quot;idx.json&quot;) as fd:
    reloaded = json.loads(fd.read())

idx = Index.load(reloaded)
idx.search(&quot;plant&quot;)
</code></pre>
<h2>Benchmark</h2>
<p>We were curious about the performance statistics so we ran some comparisons.</p>
<pre><code class="lang-python">%timeit df.loc[lambda d: d[&#39;text&#39;].str.contains(&quot;spanish&quot;)]
# 4.79 ms ± 37 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

%timeit [d for d in documents if &#39;spanish&#39; in d[&#39;text&#39;]]
# 1.86 ms ± 32.9 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

%timeit index.search(&#39;spanish&#39;)
# 304 µs ± 1.85 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

%timeit [documents[int(i[&#39;ref&#39;])] for i in index.search(&#39;spanish&#39;)]
# 309 µs ± 1.2 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</code></pre>
<p>Lunr is faster to retreive data that either a list comprehension
or a Pandas query, even if we re-use the index to fetch the original
documents.</p>
<h2>Usecase</h2>
<p>Lunr is great for smaller datasets that fit on a single machine
and for rapid prototyping. It doesn't have great support for
typos and it won't scale once your dataset grows bigger.</p>
<p>There's certainly some more features to explore in this tool, if you're
curious please check the <a href="https://lunr.readthedocs.io/en/latest/">documentation</a>.</p>

                    </div>
                    <br>
                    <a href="/" class="text-left">Back to main.</a>
                    <br>
                </article>
            </div>
        </div>
        <br>
        <script>
            document.addEventListener('DOMContentLoaded', (event) => {
                document.querySelectorAll('pre code.lang-python').forEach((block) => {
                    hljs.highlightBlock(block);
                });
            });
        </script>
    </div>
</div>

    </div>
    <!-- This example requires Tailwind CSS v2.0+ -->
    <footer style="background-color: #f8f9fa;" aria-labelledby="footer-heading">
        <h2 id="footer-heading" class="sr-only">Footer</h2>
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:py-16 lg:px-8">
            <div class="xl:grid xl:grid-cols-3 xl:gap-8">

                <div class="mt-12 grid grid-cols-2 gap-8 xl:mt-0 xl:col-span-2">
                    <div class="md:grid md:grid-cols-2 md:gap-8">
                        <div>
                            <h3 class="text-base font-medium text-gray-900 underline">Foundation</h3>
                            <ul role="list" class="mt-4 space-y-4">
                                <li>
                                    <a href="/index.html" class="text-base text-gray-500 hover:text-green-400"> Home </a>
                                </li>
                                <li>
                                    <a href="/story.html" class="text-base text-gray-500 hover:text-green-400"> Story </a>
                                </li>
                                <li>
                                    <a href="/faq.html" class="text-base text-gray-500 hover:text-green-400"> FAQ </a>
                                </li>
                            </ul>
                        </div>
                        <div class="mt-12 md:mt-0">
                            <h3 class="text-base font-medium text-gray-900 underline">Content</h3>
                            <ul role="list" class="mt-4 space-y-4">
                                <li>
                                    <a href="/labs.html" class="text-base text-gray-500 hover:text-green-400">Labs</a>
                                </li>

                                <li>
                                    <a href="/tils.html" class="text-base text-gray-500 hover:text-green-400">TILs</a>
                                </li>

                                <li>
                                    <a href="/tracks.html" class="text-base text-gray-500 hover:text-green-400">Tracks</a>
                                </li>

                                <li>
                                    <a href="/datasets.html" class="text-base text-gray-500 hover:text-green-400">Datasets</a>
                                </li>

                                <li>
                                    <a href="/deprecated.html" class="text-base text-gray-500 hover:text-green-400">Old Content</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="md:grid md:grid-cols-2 md:gap-8">
                        <div>
                            <h3 class="text-base font-medium text-gray-900 underline">Resources</h3>
                            <ul role="list" class="mt-4 space-y-4">
                                <li>
                                    <a href="/blog/" class="text-base text-gray-500 hover:text-green-400"> Blog </a>
                                </li>

                                <li>
                                    <a href="/testimonials.html" class="text-base text-gray-500 hover:text-green-400"> Testimonials </a>
                                </li>

                                <li>
                                    <a href="/privacy.html" class="text-base text-gray-500 hover:text-green-400"> Privacy </a>
                                </li>

                                <li>
                                    <a href="/terms.html" class="text-base text-gray-500 hover:text-green-400"> Terms </a>
                                </li>

                                <li>
                                    <a href="https://plausible.io/calmcode.io" class="text-base text-gray-500 hover:text-green-400"> Statistics </a>
                                </li>
                            </ul>
                        </div>
                        <div class="mt-12 md:mt-0">
                            <h3 class="text-base font-medium text-gray-900 underline">Contact</h3>
                            <ul role="list" class="mt-4 space-y-4">
                                <li>
                                    <a href="https://twitter.com/fishnets88" class="text-base text-gray-500 hover:text-green-400"> Twitter </a>
                                </li>

                                <li>
                                    <a href="https://tinyletter.com/calmcode" class="text-base text-gray-500 hover:text-green-400"> Newsletter </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="space-y-8 xl:col-span-1">
                    <img class="hidden xl:flex" src="/images/calmcode-logo.webp"/>
                    <p class="text-gray-500 text-base">Made by people who want to remedy the skill anxiety. Tools and thoughts that might make your professional life more enjoyable.</p>
                </div>
            </div>
        </div>
    </footer>
    
    
</body>
<style>
    .copy-code-button {
        position: absolute;
        top: .5rem;
        right: .5rem;
        cursor: pointer;
    }

    .copy-code-button:hover {
        cursor: pointer;
        background-color: #F2F2F2;
    }

    .copy-code-button:focus {
        background-color: #E6E6E6;
        outline: 0;
    }

    .copy-code-button:active {
        background-color: #D9D9D9;
    }

    .prose pre {
        position: relative;
    }
</style>
<script>
    function addCopyButtons(clipboard) {
        document.querySelectorAll('pre > code').forEach(function (codeBlock) {
            var button = document.createElement('button');
            button.className = 'copy-code-button';
            button.type = 'button';
            button.style.backgroundImage = "/images/copy.svg"
            var img = document.createElement('img')
            img.src = "/images/copy.svg"
            img.style.opacity = 0.75;
            img.height = 24
            img.width = 24
            img.style.margin = 0;
            button.appendChild(img)

            button.addEventListener('click', function () {
                clipboard.writeText(codeBlock.innerText).then(function () {
                    button.blur();
                }, function (error) {
                    button.innerText = 'Error';
                });
            });

            var pre = codeBlock;
            if (pre.parentNode.classList.contains('hljs')) {
                var highlight = pre.parentNode;
                highlight.parentNode.insertBefore(button, highlight);
            } else {
                pre.parentNode.insertBefore(button, pre);
            }
        });
    }

    addCopyButtons(navigator.clipboard);
</script>
</html>